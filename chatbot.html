<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rule-based Chatbot (Single File)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#9aa6b2;--bubble:#111827}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{background:linear-gradient(180deg,#071023 0%, #062235 100%);display:flex;align-items:center;justify-content:center;padding:24px;color:#e6eef6}
    .app{width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));border-radius:14px;box-shadow:0 10px 30px rgba(2,6,23,0.6);overflow:hidden;display:grid;grid-template-columns:360px 1fr}
    .left{padding:22px;background:linear-gradient(180deg, rgba(6,182,212,0.06), rgba(6,182,212,0.02));border-right:1px solid rgba(255,255,255,0.03)}
    h1{font-size:18px;margin:0 0 12px 0}
    p.lead{margin:6px 0 18px;color:var(--muted);font-size:13px}
    .rules{font-size:13px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:12px;border-radius:10px;max-height:380px;overflow:auto}
    .rule{padding:8px;border-radius:8px;background:rgba(0,0,0,0.12);margin-bottom:8px}
    .rule code{background:rgba(255,255,255,0.02);padding:4px;border-radius:6px;display:inline-block}
    .controls{display:flex;gap:8px;margin-top:12px}
    .btn{padding:8px 10px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:inherit;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#7dd3fc);color:#001018}

    .chat {display:flex;flex-direction:column;height:600px}
    .messages{flex:1;padding:20px;overflow:auto;display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00))}
    .msg{max-width:78%;padding:12px;border-radius:12px;line-height:1.3}
    .user{align-self:flex-end;background:linear-gradient(90deg,#06283d,#0a3b4f);border:1px solid rgba(255,255,255,0.03)}
    .bot{align-self:flex-start;background:linear-gradient(90deg,#0b1220,#071827);border:1px solid rgba(6,182,212,0.08)}
    .meta{font-size:11px;color:var(--muted);margin-top:6px}

    .composer{border-top:1px solid rgba(255,255,255,0.03);padding:12px;display:flex;gap:8px;align-items:center}
    .input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;outline:none}
    .small{font-size:12px;color:var(--muted)}

    @media (max-width:800px){.app{grid-template-columns:1fr;}.left{display:none}.chat{height:520px}}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Rule-based Chatbot">
    <aside class="left">
      <h1>Task 1 â€” Chatbot (Rule-based)</h1>
      <p class="lead">A simple rule-based chatbot that responds using predefined rules and pattern matching. Uses regular expressions and if/else logic to match user messages and return an appropriate response.</p>

      <div class="rules" id="rulesList">
        <!-- rule list populated by JS -->
      </div>

      <div class="controls">
        <button class="btn primary" id="addRuleBtn">Add sample rule</button>
        <button class="btn" id="resetBtn">Reset rules</button>
      </div>

      <p class="small" style="margin-top:12px">Tip: Open the browser console to see matching details. This file is self-contained â€” open it in your browser to run.</p>
    </aside>

    <main class="chat" aria-live="polite">
      <div class="messages" id="messages" role="log"></div>

      <div class="composer">
        <input id="userInput" class="input" placeholder="Say something (try: hi, hello, what can you do, thanks, time)" aria-label="Message input" />
        <button class="btn" id="sendBtn">Send</button>
        <button class="btn" id="examplesBtn">Examples</button>
      </div>
    </main>
  </div>

  <script>
    // --------------------
    // Simple rule engine
    // --------------------
    // Each rule has: id, patterns (array of regex strings), response (string or function), priority

    const rules = [
      {
        id: 'greeting',
        patterns: ['^hi\\b','^hello\\b','\\bhey\\b','^good (morning|afternoon|evening)\\b'],
        response: ()=>random(['Hello! I\'m a simple rule-based chatbot. How can I help you today?','Hi there! Ask me anything based on my rules â€” try "help".']),
        priority: 10
      },
      {
        id: 'thanks',
        patterns: ['\\bthank(s| you)\\b','\\bthx\\b'],
        response: 'You\'re welcome! Happy to help. ðŸ˜Š',
        priority: 8
      },
      {
        id: 'help',
        patterns: ['\\bhelp\\b','\\bwhat can you do\\b','\\bcapabilit(ies|y)\\b'],
        response: `I follow predefined rules (regex-based). Try: "hi", "what can you do", "time", "about", or ask me to compute a simple math like: 2+3`,
        priority: 9
      },
      {
        id: 'about',
        patterns: ['\\bwho are you\\b','\\babout\\b','\\bwhat are you\\b'],
        response: 'I\'m a demo chatbot built with if-else and pattern matching. No external APIs. You can add more rules or edit them in the code.',
        priority: 7
      },
      {
        id: 'time',
        patterns: ['\\btime\\b','what time','current time'],
        response: ()=>`Current local time is: ${new Date().toLocaleString()}`,
        priority: 6
      },
      {
        id: 'math',
        patterns: ['^\\s*([0-9+\-*/ ().]+)\\s*$'],
        response: (match)=>{
          try{
            // sanitize: allow only digits, operators and parentheses
            const expr = match[1];
            if(!/^[0-9+\-*/ ().]+$/.test(expr)) return "I can only calculate simple arithmetic (numbers and + - * / ).";
            // eslint-disable-next-line no-eval
            const val = eval(expr);
            return `Result: ${val}`;
          }catch(e){return "Sorry, couldn't evaluate that."}
        },
        priority: 5
      },
      {
        id: 'fallback',
        patterns: ['.*'],
        response: ()=>random(["I\'m not sure I understand. Try asking 'help' or 'what can you do'","Sorry, I don\'t have a rule for that. You can add one."]),
        priority: 0
      }
    ];

    // Utility: random pick
    function random(arr){return arr[Math.floor(Math.random()*arr.length)]}

    // Build rules UI
    const rulesList = document.getElementById('rulesList');
    function renderRules(){
      rulesList.innerHTML = '';
      rules.forEach(r=>{
        const el = document.createElement('div'); el.className='rule';
        el.innerHTML = `<strong>${r.id}</strong> <div style="margin-top:6px">Patterns: ${r.patterns.map(p=>`<code>${p}</code>`).join(' ')}</div>`;
        rulesList.appendChild(el);
      })
    }
    renderRules();

    // Chat UI helpers
    const messagesEl = document.getElementById('messages');

    function appendMessage(text, who='bot'){
      const m = document.createElement('div'); m.className = 'msg ' + (who==='user'?'user':'bot');
      m.innerHTML = text;
      messagesEl.appendChild(m);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // Match engine: returns best matching rule
    function matchRule(input){
      const text = input.trim().toLowerCase();
      // sort by priority desc
      const sorted = rules.slice().sort((a,b)=>b.priority - a.priority);
      for(const r of sorted){
        for(const pattern of r.patterns){
          try{
            const re = new RegExp(pattern,'i');
            const m = text.match(re);
            if(m){
              return {rule:r, match:m};
            }
          }catch(e){
            console.warn('Invalid pattern', pattern, e);
          }
        }
      }
      return null;
    }

    // Send handler
    function handleSend(){
      const inputEl = document.getElementById('userInput');
      const text = inputEl.value.trim();
      if(!text) return;
      appendMessage(escapeHtml(text), 'user');
      inputEl.value='';

      // small simulated typing delay
      setTimeout(()=>{
        const matched = matchRule(text);
        if(matched){
          const r = matched.rule;
          let response;
          if(typeof r.response === 'function'){
            try{ response = r.response(matched.match) }catch(e){ response = "(error generating response)" }
          }else response = r.response;

          console.groupCollapsed('Rule match');
          console.log('input:', text);console.log('matched rule:', r.id);console.log('match object:', matched.match);console.groupEnd();

          appendMessage(escapeHtml(response.toString()));
        }else{
          appendMessage('Sorry, I could not find a matching rule.');
        }
      }, 250 + Math.random()*400);
    }

    // helpers
    function escapeHtml(s){return String(s).replace(/[&<>]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;' }[c]))}

    // add sample rule dynamically
    document.getElementById('addRuleBtn').addEventListener('click', ()=>{
      const newRule = {
        id: 'joke'+Math.floor(Math.random()*1000),
        patterns: ['\\btell me a joke\\b','\\bjoke\\b'],
        response: ()=>random(['Why did the developer go broke? Because he used up all his cache.','I would tell you a UDP joke, but you might not get it.']),
        priority:4
      };
      rules.splice(rules.length-1,0,newRule); // insert before fallback
      renderRules();
      alert('Added a sample "joke" rule. Try: "tell me a joke"');
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{ if(confirm('Reset to default rules?')) location.reload(); });

    // examples button
    document.getElementById('examplesBtn').addEventListener('click', ()=>{
      const examples = ['hi','what can you do','time','2+3*5','tell me a joke','thanks'];
      const ex = examples[Math.floor(Math.random()*examples.length)];
      document.getElementById('userInput').value = ex; document.getElementById('userInput').focus();
    });

    document.getElementById('sendBtn').addEventListener('click', handleSend);
    document.getElementById('userInput').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); handleSend(); } });

    // accessibility startup message
    appendMessage('Hello! I\'m a rule-based chatbot â€” try saying "hi" or "help" to get started.');

  </script>
</body>
</html>
